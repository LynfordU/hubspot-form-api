<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <title>Landing Page</title>
  </head>


  <body class="p-3 bg-dark bg-gradient text-light">

    <div class="row d-flex justify-content-center border-bottom border-5 border-success">
        <h1>Hubspot Form API</h1>
    </div>

    <div class="row mt-5 mb-6">
        
        <div class="col-sm-2">
        </div>

        <div class="col-sm-5">
            <h2>Create A Contact In Hubspot</h2>
        </div>

        <!-- Form -->
            <form class="col-sm-3 form-floating" id="myform">
                <input type="text" class="form-control mb-3" placeholder="First Name" name="firstname" id="firstname">
                <input type="text" class="form-control mb-3" placeholder="Last Name" name="lastname" id="lastname">
                <input type="email" class="form-control mb-3" placeholder="Email" name="email" id="email">
                <input type="tel" class="form-control mb-3" placeholder="Phone Number" name="phone" id="phone">
                <button type="button" class="btn btn-outline-success text-uppercase" onclick="formv3()">submit</button>
            </form>

        <div class="col-sm-2">
        </div>

    </div>
    
    <!-- Section 2 -->

    <div class="row mt-5 bg-light text-dark">

        <div class="row">
            <div class="col mt-5 d-flex justify-content-center">
                <h2>Project Info</h2>
            </div>
        </div>

        <div class="row mt-5">
            <div class="col">
                <h4>See the requested contact in my Hubspot portal:</h4>
            </div>

            <div class="col">
                <a href="https://app.hubspot.com/contacts/21760335/contact/201/" class="btn btn-success" role="button" target="blank">Go To Contact In Hubspot</a>
            </div>
        </div>

    </div>

    </body>
       <!-- Start of HubSpot Embed Code -->
       <script type="text/javascript" id="hs-script-loader" async defer src="//js.hs-scripts.com/21760335.js"></script>
       <!-- End of HubSpot Embed Code -->
       <script>
       function formv3(){
          // Create the new request
          var xhr = new XMLHttpRequest();
          var url = 'https://api.hsforms.com/submissions/v3/integration/submit/21760335/daf71958-5498-45c7-92f6-e2b9592ff014';
          var getEmail = document.getElementById("email").value;
          var getFirstName = document.getElementById("lastname").value;
          var getLastName = document.getElementById("firstname").value;
          var getPhoneNumber = document.getElementById("phone").value;
           var getCookie = document.cookie.replace(/(?:(?:^|.;\s)hubspotutk\s*\=\s*([^;]*).$)|^.$/, "$1");
          // Example request JSON:
          var data = {
            "fields": [
              {
                "name": "email",
                "value": getEmail
              },
              {
                "name": "firstname",
                "value": getFirstName
              },
              {
                "name": "lastname",
                "value": getLastName
              },
              {
                "name": "phone",
                "value": getPhoneNumber
              }
            ],
            "context": {
              "hutk": null, 
              "pageUri": "www.example.com/page",
              "pageName": "Form API Test"
            },
            "legalConsentOptions":{
              "consent":{
                "consentToProcess":true,
                "text":"I agree to allow Example Company to store and process my personal data.",
                "communications":[
                  {
                    "value":true,
                    "subscriptionTypeId":999,
                    "text":"I agree to receive marketing communications from Example Company."
                  }
                ]
              }
            }
          }
          var final_data = JSON.stringify(data)
          xhr.open('POST', url);
          // Sets the value of the 'Content-Type' HTTP request headers to 'application/json'
          xhr.setRequestHeader('Content-type', 'application/json');
          xhr.onreadystatechange = function() {
              if(xhr.readyState == 4 && xhr.status == 200) {
                  alert(xhr.responseText); // Returns a 200 response if the submission is successful.
              } else if (xhr.readyState == 4 && xhr.status == 400){
                  alert(xhr.responseText); // Returns a 400 error the submission is rejected.
              } else if (xhr.readyState == 4 && xhr.status == 403){
                  alert(xhr.responseText); // Returns a 403 error if the portal isn't allowed to post submissions.
              } else if (xhr.readyState == 4 && xhr.status == 404){
                  alert(xhr.responseText); //Returns a 404 error if the formGuid isn't found
              }
             }
          // Sends the request
          xhr.send(final_data)
          setTimeout(function() {document.getElementById('myform').submit();}, 3000);
       }
       </script>
       </html>
